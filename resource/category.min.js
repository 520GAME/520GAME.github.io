const cate_tagNew=document.getElementById("tag-new"),cate_tagNew_input=document.getElementById("tagNew"),cate_tagRandom=document.getElementById("tag-random"),cate_tagRandom_input=document.getElementById("tagRand"),cate_tagCapacity=document.getElementById("tag-capacity"),cate_tagCapacity_input=document.getElementById("tagCapacity"),cate_tagFire=document.getElementById("tag-fire"),cate_tagFire_input=document.getElementById("tagFire"),pageBar=document.getElementById("pageBar"),containerCards=document.getElementById("container-cards"),categoryTagsUl=document.getElementById("category-tags-ul"),containerLoading=document.getElementById("container-loading");cate_tagNew.addEventListener("click",(()=>{"全部"==currentClassifyText?(getCurrentClassifyCards(),console.log("全部",currentClassifyCards),showThis(getCurrentShowCards(1))):(getCurrentClassifyCards(currentClassifyText),showThis(getCurrentShowCards(1)))})),cate_tagRandom.addEventListener("click",(()=>{currentClassifyCards.sort((()=>Math.random()-.5)),showThis(getCurrentShowCards(1))})),cate_tagCapacity.addEventListener("click",(()=>{currentClassifyCards.sort(((e,t)=>parseFloat(t.capacity)-parseFloat(e.capacity))),showThis(getCurrentShowCards(1))})),cate_tagFire.addEventListener("click",(()=>{currentClassifyCards.sort(((e,t)=>parseFloat(t.grade)-parseFloat(e.grade))),showThis(getCurrentShowCards(1))}));const cate_tag=document.getElementsByClassName("tag");for(let e=0;e<cate_tag.length;e++)cate_tag[e].addEventListener("click",(()=>{currentClassifyText=cate_tag[e].innerHTML,"全部"==cate_tag[e].innerHTML?(getCurrentClassifyCards(),showThis(getCurrentShowCards(1))):(getCurrentClassifyCards(cate_tag[e].innerHTML),showThis(getCurrentShowCards(1))),cate_tagNew_input.checked=!0,cate_tagRandom_input.checked=!1}));let allCards=[],currentClassifyCards=[],currentShowCards=[];const perPageNum=16;let totalPages,currentPageNum=1,currentClassifyText="全部";var url="../data/data.json",request=new XMLHttpRequest;function formatDate(e){var t=new Date(+e),a=t.getFullYear(),n=t.getMonth()+1,r=t.getDate();return n<10&&(n="0"+n),r<10&&(r="0"+r),a+"-"+n+"-"+r}request.open("get",url),request.send(null),request.onload=function(){var e=JSON.parse(request.responseText),t=[];e.forEach((e=>{null!=e&&t.push(e)})),allCards=t,getCurrentClassifyCards(),showThis(getCurrentShowCards(1));var a=new URLSearchParams(window.location.search).get("text");if(null!=a&&""!=a){document.title=a+"-520GAME-全球免费热门游戏分享";let e=!1;for(let t=0;t<cate_tag.length;t++)if(cate_tag[t].innerHTML==a){e=!0,getCurrentClassifyCards(cate_tag[t].innerHTML),showThis(getCurrentShowCards(1));var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});cate_tag[t].dispatchEvent(n)}if(!e){var r=document.createElement("li"),s=document.createElement("a");s.setAttribute("href","#");var c=document.createElement("input");c.setAttribute("type","radio"),c.setAttribute("name","tags"),c.setAttribute("id","tag999");var i=document.createElement("label");i.setAttribute("id","tag999"),i.setAttribute("class","tag"),i.setAttribute("for","tag999"),i.textContent=a,i.addEventListener("click",(()=>{currentClassifyText=i.innerHTML,"全部"==i.innerHTML?(getCurrentClassifyCards(),showThis(getCurrentShowCards(1))):(getCurrentClassifyCards(i.innerHTML),showThis(getCurrentShowCards(1))),c.checked=!0})),s.appendChild(c),s.appendChild(i),r.appendChild(s),categoryTagsUl.appendChild(r);n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});i.dispatchEvent(n)}}};const showThis=e=>{containerLoading.style.display="none";let t="";e.forEach(((e,a)=>{let n=e.classify.split("|"),r="",s="";r="全部"==currentClassifyText?n[0]:currentClassifyText,s=r==n[0]?n[1]:n[0],t+=`<div class="container-card">\n            <a class="con-card-img" a itemprop="url" rel="bookmark" href="/articles/${e.id}.html"\n                title="${e.detail}" target="_blank"\n                style="background-image: url('${e.img}');"></a>\n            <div class="con-card-classifyList">\n                <div class="con-card-classify"><a href="/category.html?text=${r}">${r}</a></div>\n                <div class="con-card-classify2"><a href="/category.html?text=${s}">${s}</a></div>\n            </div>\n            <h3 itemprop="name headline"><a itemprop="url" rel="bookmark" href="/articles/${e.id}.html"\n                    title="${e.detail}"\n                    target="_blank">${e.detail}</a></h3>\n            <div class="time-row">\n                <div class="time-contain"><a href="/articles/${e.id}.html">${formatDate(e.time)}</a></div>\n                <div class="capacity-contain"><a href="/articles/${e.id}.html">${e.capacity}</a></div>\n                </div>\n            <div class="card-free">免费</div>\n        </div>`})),containerCards.innerHTML=t},getCurrentClassifyCards=e=>{let t=[];null==e?(totalPages=Math.ceil(allCards.length/16),allCards.forEach((e=>{t.push(e)}))):(allCards.forEach((a=>{null!=a.classify&&a.classify.includes(e)&&t.push(a)})),totalPages=Math.ceil(t.length/16)),currentClassifyCards=t},getCurrentShowCards=e=>{if(e<1||e>totalPages)return[];currentPageNum=e,showPageBar(e);const t=16*(e-1),a=Math.min(t+16,currentClassifyCards.length),n=currentClassifyCards.slice(t,a);return window.scrollTo(0,0),n},showPageBar=e=>{pageBar.innerHTML="";const t=document.createElement("div");if(t.className="pageItem",t.id="upPage",t.innerHTML="上一页",t.addEventListener("click",(()=>{currentPageNum>1&&showThis(getCurrentShowCards(currentPageNum-1))})),pageBar.appendChild(t),e<=3){for(let t=1;t<=Math.min(5,totalPages);t++){const a=document.createElement("div");a.className="pageItem",t==e&&(a.className="pageItem pageItemActive"),a.innerHTML=""+t,a.addEventListener("click",(()=>{t!=currentPageNum&&showThis(getCurrentShowCards(t))})),pageBar.appendChild(a)}if(totalPages>5){if(6!=totalPages){const e=document.createElement("div");e.className="pageItem",e.innerHTML="...",pageBar.appendChild(e)}const e=document.createElement("div");e.className="pageItem",e.innerHTML=""+totalPages,e.addEventListener("click",(()=>{totalPages!=currentPageNum&&showThis(getCurrentShowCards(totalPages))})),pageBar.appendChild(e)}}else if(e>=totalPages-2){const t=document.createElement("div");if(t.className="pageItem",t.innerHTML="1",t.addEventListener("click",(()=>{1!=currentPageNum&&showThis(getCurrentShowCards(1))})),pageBar.appendChild(t),e-5>1){const e=document.createElement("div");e.className="pageItem",e.innerHTML="...",pageBar.appendChild(e)}for(let t=Math.max(1,totalPages-4);t<=totalPages;t++){const a=document.createElement("div");a.className="pageItem",t==e&&(a.className="pageItem pageItemActive"),a.innerHTML=""+t,a.addEventListener("click",(()=>{t!=currentPageNum&&showThis(getCurrentShowCards(t))})),pageBar.appendChild(a)}}else{const t=document.createElement("div");if(t.className="pageItem",t.innerHTML="1",t.addEventListener("click",(()=>{1!=currentPageNum&&showThis(getCurrentShowCards(1))})),pageBar.appendChild(t),4!=e){const e=document.createElement("div");e.className="pageItem",e.innerHTML="...",pageBar.appendChild(e)}for(let t=e-2;t<=e+2;t++){const a=document.createElement("div");a.className="pageItem",t==e&&(a.className="pageItem pageItemActive"),console.log("添加第 "+t+" 个,toPage为："+(t<=e)),a.addEventListener("click",(()=>{t!=currentPageNum&&showThis(getCurrentShowCards(t))})),a.innerHTML=""+t,pageBar.appendChild(a)}if(e!=totalPages-3){const e=document.createElement("div");e.className="pageItem",e.innerHTML="...",pageBar.appendChild(e)}const a=document.createElement("div");a.className="pageItem",a.innerHTML=""+totalPages,a.addEventListener("click",(()=>{totalPages!=currentPageNum&&showThis(getCurrentShowCards(totalPages))})),pageBar.appendChild(a)}const a=document.createElement("div");a.className="pageItem",a.id="downPage",a.innerHTML="下一页",a.addEventListener("click",(()=>{currentPageNum<totalPages&&showThis(getCurrentShowCards(currentPageNum+1))})),pageBar.appendChild(a);const n=document.createElement("input");n.id="pageInput",n.placeholder="页码",pageBar.appendChild(n);const r=document.createElement("div");r.id="toPageBtn",r.innerHTML="跳转",r.addEventListener("click",(()=>{const e=document.getElementById("pageInput").value;showThis(getCurrentShowCards(+e))})),pageBar.appendChild(r)};