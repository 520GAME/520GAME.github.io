const containerCards=document.getElementById("containerCards"),searchInput=document.getElementById("searchInput"),searchForm=document.getElementById("searchForm");searchForm.addEventListener("submit",(e=>{document.location.href="/search.html?text="+searchInput.value,e.preventDefault()}));let allCards=[],currentClassifyCards=[],currentShowCards=[];const perPageNum=16;let totalPages,currentPageNum=1,currentClassifyText="全部";var url="../data/data.json",request=new XMLHttpRequest;function formatDate(e){var a=new Date(+e),t=a.getFullYear(),n=a.getMonth()+1,r=a.getDate();return n<10&&(n="0"+n),r<10&&(r="0"+r),t+"-"+n+"-"+r}request.open("get",url),request.send(null),request.onload=function(){var e=JSON.parse(request.responseText),a=[];e.forEach((e=>{null!=e&&a.push(e)})),allCards=a;var t=new URLSearchParams(window.location.search).get("text");if(null!=t&&""!=t){searchInput.value=t,document.title=t,getCurrentCards(t),currentPageNum=1,showThis(getCurrentShowCards(currentPageNum));let e=localStorage.getItem("520GameRCTSerchTags"),a=[];if(console.log("search_recentTags:",typeof e),null!=e){a=JSON.parse(e);let n=a.indexOf(t);-1!=n&&a.splice(n,1)}if(a.unshift(t),a.length>30){let e=[];for(let t=0;t<30;t++)e.push(a[t]);a=e}console.log("temp_tags:",a),localStorage.setItem("520GameRCTSerchTags",JSON.stringify(a))}};const showThis=e=>{let a="";e.forEach(((e,t)=>{a+=`<div class="container-card">\n            <a class="con-card-img" a itemprop="url" rel="bookmark" href="/articles/${e.id}.html"\n                title="${e.detail}" target="_blank"\n                style="background-image: url('${e.img}');"></a>\n            <div class="con-card-classify"><a href="#">${e.classify.split("|")[0]}</a></div>\n            <h3 itemprop="name headline"><a itemprop="url" rel="bookmark" href="/articles/${e.id}.html"\n                    title="${e.detail}"\n                    target="_blank">${e.detail}</a></h3>\n            <div class="time-row">\n                <div class="time-contain"><a href="/articles/${e.id}.html">${formatDate(e.time)}</a></div>\n                <div class="capacity-contain"><a href="/articles/${e.id}.html">${e.capacity}</a></div>\n                </div>\n            <div class="card-free">免费</div>\n        </div>`})),containerCards.innerHTML=a},getCurrentCards=e=>{let a=[];null==e||(allCards.forEach((t=>{t.detail.includes(e)&&a.push(t)})),totalPages=Math.ceil(a.length/16)),currentClassifyCards=a},getCurrentShowCards=e=>{if(e<1||e>totalPages)return[];currentPageNum=e,showPageBar(e);const a=16*(e-1),t=Math.min(a+16,currentClassifyCards.length),n=currentClassifyCards.slice(a,t);return window.scrollTo(0,0),n},showPageBar=e=>{pageBar.innerHTML="";const a=document.createElement("div");if(a.className="pageItem",a.id="upPage",a.innerHTML="上一页",a.addEventListener("click",(()=>{currentPageNum>1&&showThis(getCurrentShowCards(currentPageNum-1))})),pageBar.appendChild(a),e<=3){for(let a=1;a<=Math.min(5,totalPages);a++){const t=document.createElement("div");t.className="pageItem",a==e&&(t.className="pageItem pageItemActive"),t.innerHTML=""+a,t.addEventListener("click",(()=>{a!=currentPageNum&&showThis(getCurrentShowCards(a))})),pageBar.appendChild(t)}if(totalPages>5){if(6!=totalPages){const e=document.createElement("div");e.className="pageItem",e.innerHTML="...",pageBar.appendChild(e)}const e=document.createElement("div");e.className="pageItem",e.innerHTML=""+totalPages,e.addEventListener("click",(()=>{totalPages!=currentPageNum&&showThis(getCurrentShowCards(totalPages))})),pageBar.appendChild(e)}}else if(e>=totalPages-2){const a=document.createElement("div");if(a.className="pageItem",a.innerHTML="1",a.addEventListener("click",(()=>{1!=currentPageNum&&showThis(getCurrentShowCards(1))})),pageBar.appendChild(a),e-5>1){const e=document.createElement("div");e.className="pageItem",e.innerHTML="...",pageBar.appendChild(e)}for(let a=Math.max(1,totalPages-4);a<=totalPages;a++){const t=document.createElement("div");t.className="pageItem",a==e&&(t.className="pageItem pageItemActive"),t.innerHTML=""+a,t.addEventListener("click",(()=>{a!=currentPageNum&&showThis(getCurrentShowCards(a))})),pageBar.appendChild(t)}}else{const a=document.createElement("div");if(a.className="pageItem",a.innerHTML="1",a.addEventListener("click",(()=>{1!=currentPageNum&&showThis(getCurrentShowCards(1))})),pageBar.appendChild(a),4!=e){const e=document.createElement("div");e.className="pageItem",e.innerHTML="...",pageBar.appendChild(e)}for(let a=e-2;a<=e+2;a++){const t=document.createElement("div");t.className="pageItem",a==e&&(t.className="pageItem pageItemActive"),console.log("添加第 "+a+" 个,toPage为："+(a<=e)),t.addEventListener("click",(()=>{a!=currentPageNum&&showThis(getCurrentShowCards(a))})),t.innerHTML=""+a,pageBar.appendChild(t)}if(e!=totalPages-3){const e=document.createElement("div");e.className="pageItem",e.innerHTML="...",pageBar.appendChild(e)}const t=document.createElement("div");t.className="pageItem",t.innerHTML=""+totalPages,t.addEventListener("click",(()=>{totalPages!=currentPageNum&&showThis(getCurrentShowCards(totalPages))})),pageBar.appendChild(t)}const t=document.createElement("div");t.className="pageItem",t.id="downPage",t.innerHTML="下一页",t.addEventListener("click",(()=>{currentPageNum<totalPages&&showThis(getCurrentShowCards(currentPageNum+1))})),pageBar.appendChild(t);const n=document.createElement("input");n.id="pageInput",n.placeholder="页码",pageBar.appendChild(n);const r=document.createElement("div");r.id="toPageBtn",r.innerHTML="跳转",r.addEventListener("click",(()=>{const e=document.getElementById("pageInput").value;showThis(getCurrentShowCards(+e))})),pageBar.appendChild(r)};